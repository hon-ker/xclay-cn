"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6896],{9581:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(85893),o=n(9473),l=n(41664),a=n.n(l),c=n(44319);let s=e=>{let{className:t,items:n,onClick:o}=e;return(0,r.jsx)("div",{className:t,children:n.map((e,t)=>(0,r.jsxs)(a(),{className:"group flex items-center mb-5 p-3.5 border border-n-3 rounded-xl h6 transition-all hover:border-transparent hover:shadow-[0_0_1rem_0.25rem_rgba(0,0,0,0.04),0px_2rem_1.5rem_-1rem_rgba(0,0,0,0.12)] last:mb-0 2xl:p-2.5 lg:p-3.5 dark:border-n-5 dark:hover:border-n-7 dark:hover:bg-n-7",href:e.url||"/",onClick:()=>o&&o(),children:[(0,r.jsxs)("div",{className:"relative flex justify-center items-center w-15 h-15 mr-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-20 rounded-xl",style:{backgroundColor:e.color}}),(0,r.jsx)(c.Z,{className:"relative z-1",fill:e.color,name:e.icon})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{children:e.title}),e.desc&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.desc})]}),(0,r.jsx)(c.Z,{className:"ml-auto fill-n-4 transition-colors group-hover:fill-n-7 dark:group-hover:fill-n-4",name:"arrow-next"})]},t))})},i=e=>{let{page:t,json:n,onClick:l}=e,{language:{browserLanguage:a}}=(0,o.v9)(e=>e),c=e=>{try{return n[e].title[a]||n[e].title.en}catch(e){}},i=e=>{try{return n[e].desc[a]||n[e].desc.en}catch(e){}},d=[];return"chat"==t?d=[{title:c("longTermMemory"),desc:i("longTermMemory"),icon:"trophy",color:"#0084FF",url:"/long-term-memory"},{title:c("codeGeneration"),desc:i("codeGeneration"),icon:"codepen",color:"#52BA69",url:"/code-generation"},{title:c("codePlugins"),desc:i("codePlugins"),icon:"play-circle",color:"#D84C10",url:"/code-plugins"}]:"search"==t&&(d=[{title:n.accuracy.title[a]||n.accuracy.title.en,desc:n.accuracy.desc[a]||n.accuracy.desc.en,icon:"codepen",color:"#52BA69",url:"/accuracy"},{title:n.realTimeSearch.title[a]||n.realTimeSearch.title.en,desc:n.realTimeSearch.desc[a]||n.realTimeSearch.desc.en,icon:"image-check",color:"#8E55EA",url:"/real-time-search"},{title:n.mathematical.title[a]||n.mathematical.title.en,desc:n.mathematical.desc[a]||n.mathematical.desc.en,icon:"trophy",color:"#0084FF",url:"/mathematical"}]),(0,r.jsx)(s,{className:"max-w-[32.75rem] mx-auto",items:d,onClick:()=>l()})};var d=i},56726:function(e,t,n){var r=n(85893),o=n(67294),l=n(51382),a=n(65880);let c=e=>{let{children:t,refresh:n,refreshDialogue:c,cStatus:s,conv_tree:i,childrenClassName:d,modelShow:u,setModelShow:m}=e,{statusDataReset:h}=(0,o.useContext)(a.p),g=(0,o.useRef)(null),p=(0,o.useRef)(null),[f,x]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),b=(0,o.useRef)(null),[w,k]=(0,o.useState)(!1),[j,N]=(0,o.useState)(!1),[S,E]=(0,o.useState)("down");(0,o.useEffect)(()=>{m&&m("down"!=S)},[S,m]),(0,o.useEffect)(()=>{var e;let t=()=>{w&&(console.log("正在拖动滚动条"),f||x(!0))};return null===(e=b.current)||void 0===e||e.addEventListener("scroll",t),window.addEventListener("mousedown",C),window.addEventListener("mouseup",I),(()=>{let e=b.current;(null==e?void 0:e.scrollHeight)>(null==e?void 0:e.clientHeight)?N(!0):N(!1)})(),()=>{let e=b.current;null==e||e.removeEventListener("scroll",t),window.removeEventListener("mousedown",C),window.removeEventListener("mouseup",I)}},[w]);let C=e=>{var t,n;let r=e.target===b.current&&(null===(t=b.current)||void 0===t?void 0:t.scrollHeight)>(null===(n=b.current)||void 0===n?void 0:n.clientHeight);r&&k(!0)},I=()=>{k(!1)},T=e=>{f||v||(console.log("onWheel"),x(!0))},[_,O]=(0,o.useState)(0),M=e=>{let{scrollTop:t,scrollHeight:n,clientHeight:r}=b.current,o=n-t<=r+1;if(o&&!v?(console.log(o,"到底了"),"responding"==s&&f&&x(!1),y(o)):!o&&v&&y(o),p.current&&(o?p.current.style.display="none":p.current.style.display="flex"),!f)return!1;let l=e.currentTarget.scrollTop,a=b.current;if(!a||!a.scrollHeight){console.log(1111);return}let c=a.scrollHeight-a.clientHeight<=l;if(l<=0||c){O(l);return}l>_&&"up"==S?(console.log("向下滚动"),E("down")):l<_&&"down"==S&&(console.log("向上滚动"),E("up")),O(l)},[B,D]=(0,o.useState)(n),A=e=>{var t;null===(t=g.current)||void 0===t||t.scrollIntoView({behavior:e}),!u&&m&&m(!0)};return(0,o.useEffect)(()=>{n!==B&&A("auto"),!i||f||w||A("auto"),D(n)},[i,n,B,f,w]),(0,o.useEffect)(()=>{x(!1)},[c,h]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative z-2 grow pt-4 md:p-3 overflow-y-auto scrollbar-test ",id:"sw",ref:b,onScroll:M,onWheel:T,onTouchMove:T,children:[(0,r.jsx)("div",{className:"grow px-10 pb-7 md:px-0 md:pt-0  ".concat(d||""),id:"html2canvas",children:t}),(0,r.jsx)("div",{ref:g,style:{marginTop:0,marginBottom:0,height:"5rem"}})]}),"dialogue"===s&&(0,r.jsx)("button",{ref:p,className:"scrollToBottom z-20  dark:bg-n-5 w-7 h-7  rounded-full absolute print-hide right-[0.8rem] md:right-[.5rem] bottom-[5.2rem]  text-center leading-[1.6rem] border border-gray-200 bg-gray-50 text-gray-600 dark:border-white/10 dark:bg-white/10 dark:text-gray-200 md:bottom-[6.4rem] justify-center items-center hidden",onClick:()=>{A("smooth")},children:(0,r.jsx)(l.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-200 ",style:{display:"inline-block"}})})]})};t.Z=c},34546:function(e,t,n){n.d(t,{H:function(){return h},$:function(){return d}});var r=n(85893),o=n(91350),l=n(9473),a=n(62161),c=n(41478),s=n(1852);let i=e=>{let{stop:t,MODE:n,thatLastErr:i}=e,d=(0,l.I0)(),u=(0,s.useMediaQuery)({query:"(max-width: 765px)"});return(0,r.jsx)("div",{className:"flex justify-center relative",children:(0,r.jsxs)("button",{className:"group text-sm flex items-center px-4 py-1.5 bg-n-3 rounded-md caption1 text-n-6 transition-colors hover:text-primary-1 dark:bg-n-7 dark:text-n-3 dark:hover:text-primary-1 print-actions ".concat(u&&!i?" bg-[transparent!important] w-10 px-[0!important] py-[0!important] flex justify-center items-center":i?"mb-10":"mb-2"),onClick:()=>{t.abort&&t.abort(),d((0,a.Hr)({page:n,status:"dialogue"})),u||d((0,c.yA)())},children:[(0,r.jsx)(o.Z,{className:"".concat(u?"w-7 h-7 transition-colors":"w-5 h-5 mr-1 transition-colors dark:fill-n-3")}),!u&&"Stop"]})})};var d=i,u=n(85973);let m=e=>{let{onClick:t,thatLastErr:n}=e,o=(0,s.useMediaQuery)({query:"(max-width: 765px)"});return(0,r.jsx)("div",{className:"flex justify-center relative",children:(0,r.jsxs)("button",{className:"group text-sm flex items-center px-4 py-1.5 bg-n-3 rounded-md caption1 text-n-6 transition-colors hover:text-primary-1 dark:bg-n-7 dark:text-n-3 dark:hover:text-primary-1 print-actions ".concat(o&&!n?" bg-[transparent!important] w-10 px-[0!important] py-[0!important] flex justify-center items-center":n?"mb-10":"mb-2"),onClick:()=>{t()},children:[(0,r.jsx)(u.Z,{className:"".concat(o&&!n?"w-5 h-5 transition-colors":"w-4 h-4 mr-1 transition-colors")}),(!o||n)&&"Regenerate"]})})};var h=m},98354:function(e,t,n){var r=n(85893),o=n(67294),l=n(26970),a=n(93162),c=n(64749),s=n(47116),i=n(9473),d=n(4869),u=n(9177);let m=e=>{var t;let{visible:n,onClose:m,setVisibleModal:h,tid:g,conv_tree:p}=e,[f,x]=(0,o.useState)(null),{config:{mode:v}}=(0,i.v9)(e=>e),[y,b]=(0,o.useState)("PDF"),[w]=(0,o.useState)([{value:"PDF",label:"PDF"},{value:"Markdown",label:"Markdown"},{value:"JSON",label:"JSON"},{value:"CSV",label:"CSV"}]),k=async e=>{if(f)e(f);else{let t="chat"==v?await(0,d.uv)(g):await(0,d.Rw)(g);t.success?(x(t.data),e(t.data)):e(!1)}},j=(0,s.useReactToPrint)({documentTitle:null==f?void 0:null===(t=f.topic)||void 0===t?void 0:t.title,content:()=>{h(!1);let e=document.getElementById("print-view");return e}});function N(e,t,n){if(e.selected){let{children:r,...o}=e;t.push({...o,parent_id:n})}if(e.children&&e.children.length>0)for(let n of(console.log(e.id,"nodenodenode"),e.children))n.selected&&N(n,t,e.id)}let S=async e=>{var t,n;let r;let o=e=>{if(Array.isArray(e)){let t="";return e.map(e=>{2==e.type?t+="Used ".concat(e.args.name,"\n\nREQUEST TO ").concat(e.args.name.toUpperCase(),"\n\n").concat(e.args.content,"\n\n"):3==e.type?t+="RESPONSE FROM ".concat(e.args.name.toUpperCase(),"\n\n").concat(e.args.content,"\n\n").concat(e.args.name," End \n\n"):t+=e.args.content+"\n\n"}),t}return e};switch(y){case"JSON":let l=[];for(let e of p)e.selected&&N(e,l);let c={model_name:null===(t=document.getElementById("model_name"))||void 0===t?void 0:t.innerText,selectedJSON:l};r=new Blob([JSON.stringify(c)],{type:"text/json;charset=utf-8"});break;case"Markdown":let s="Title: "+e.topic.title+"\n\nID: "+e.topic.id+"\n\n"+("chat"==v?"Model: ".concat(null===(n=document.getElementById("model_name"))||void 0===n?void 0:n.innerText,"\n\n"):""),i=[];for(let e of p)e.selected&&N(e,i);console.log(i,"selectedMarkDown"),i.map(e=>{s+=1==e.role?"User：\n".concat(e.attachments.join(","),"\n").concat(e.content,"\n\n"):"Assistant：\n".concat(o(e.content),"\n\n")}),r=new Blob([s],{type:"text/markdown;charset=utf-8"});break;case"CSV":try{let e=["ID,User,ID,Assistant\n"],t=[];for(let e of p)e.selected&&N(e,t);let n=[];for(let e=0;e<t.length;e+=2)if(t[e]&&t[e+1]){let r=t[e],o=t[e+1];n.push({role1:r,role2:o})}n.forEach(t=>{let n=t.role1,r=t.role2;e.push("".concat(n.id,',"').concat(n.attachments.join(","),"\n").concat(n.content?n.content.replace(/，|,/g,"、"):"",'",').concat(r.id,',"').concat(o(r.content)?o(r.content).replace(/，|,/g,"、").replace(/"/g,"'"):"",'"\n'))}),r=new Blob(e,{type:"text/csv;charset=utf-8"})}catch(e){}break;case"PDF":j();break;default:return}r&&(0,a.saveAs)(r,"".concat(e.topic.title,"_").concat(new Date().toISOString(),".").concat(("Markdown"==y?"MD":y).toLowerCase()))},E=(0,o.useRef)(null);return(0,o.useEffect)(()=>{n||x(null)},[n]),(0,r.jsx)(l.Z,{classWrap:"max-w-[40rem]",classButtonClose:"absolute top-6 right-6 w-10 h-10 rounded-full bg-n-2 md:top-5 md:right-5 dark:bg-n-4/25 dark:fill-n-4 dark:hover:fill-n-1",visible:n,onClose:m,initialFocus:E,children:(0,r.jsxs)("div",{className:"p-12 md:p-5",children:[(0,r.jsx)("div",{className:"mb-8 h4",children:"Export this chat"}),(0,r.jsx)(c.default,{defaultValue:y,onChange:e=>b(e),className:"w-full mb-4 dark:antd-select-dark",popupClassName:"dark:ant-select-dropdown",options:w}),(0,r.jsxs)("div",{className:"flex justify-end",children:[(0,r.jsx)("button",{className:"btn-stroke-light mr-3",onClick:m,children:"Cancel"}),(0,r.jsx)("button",{className:"btn-blue",onClick:()=>{k(e=>{e?S(e):(0,u.Z)({content:"Please try again later",iconCircle:!0})})},children:"Export"})]})]})})};t.Z=m},84913:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(1375),o=n(98287);class l extends Error{}class a extends Error{}function c(e){let{url:t,method:n,body:c,headers:s={},onOpen:i,onMessage:d,onError:u,onClose:m,onFinally:h}=e,g=new AbortController,p=g.signal,f=localStorage.getItem("token");return f&&(0,r.L)(o.JW+t,{method:n||"POST",headers:Object.assign({"Content-Type":"application/json",Authorization:"Bearer "+f},s),body:c,signal:p,openWhenHidden:!0,async onopen(e){console.log(e,"onopen");try{if(e.ok){i&&i({success:!0});return}if(200!==e.status){let t=await e.body.getReader().read(),n=new TextDecoder().decode(t.value);throw i&&n&&i(JSON.parse(n)),console.log("读取到的数据:",n),new a}throw new l}catch(e){}},onmessage:async e=>{d&&d(e)},onerror:e=>{console.log(e,"error"),u&&u(e),h&&h();try{throw new a}catch(e){}},onclose:()=>{console.log("onclose"),m&&m(),h&&h()}}),g}},51900:function(e,t,n){n.d(t,{i:function(){return o},r:function(){return l}});var r=n(14328);let o=e=>{let{model:t,message:n,attachments:r,save:o,parentId:l,regenerate:a,conv_tree:c,setConvTree:s}=e,i=Math.random(),d=Math.random(),u={content:n,attachments:r,end_at:null,id:i,mod_result:0,role:1,selected:!0,time:"",children:[{children:[],content:[],end_at:null,id:d,mod_result:0,role:2,selected:!0,loading:!0,time:"",model:t}]},m={save:o,parentId:l,conv_tree:c,setConvTree:s};return l?(console.log("parentId"),m=Object.assign(m,{addInfo:{id:l,addItem:u}})):a?(console.log("regenerate"),m=Object.assign(m,{regenerateItem:{id:a,rid:d,model:t}})):(console.log("pushItem"),m=Object.assign(m,{pushItem:u})),{cid1:i,cid2:d,Obj:m}},l=async e=>{let{last:t,save:n,parentId:o,thatLastErr:l,regenerate:a,conv_tree:c}=e;if(o)return o;let s=await(0,r.f4)(t.lastTree);if(l&&s)return s;if(a){console.log(s,"regenerate errParentId"),console.log(a,"regenerate");try{if("number"==typeof a){let e=await(0,r.C8)(c);return e}return s||a}catch(e){console.error(e,"errorerror")}}return t.lastId&&String(t.lastId).indexOf(".")>-1?(console.log("random"),null):t.lastId&&!n&&-1==String(t.lastId).indexOf(".")?(console.log(t.lastId,"last.lastId"),t.lastId):(console.log("null"),null)}}}]);